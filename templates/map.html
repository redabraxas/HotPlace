{% extends "index.html" %}
{% block body %}

<!-- {% for entry in entries %}
 <li>  <h2>{{ entry }}</h2>
 {% else %}
 <li> <em>Unbelievable. No entries here so far</em>
 {% endfor %} -->



			
			<div id="map" style="border:1px solid #000;"></div>


			<script type="text/javascript" src="http://openapi.map.naver.com/openapi/naverMap.naver?ver=2.0&key=7f988a1d3bc4b0767fef224ef85d1743"></script>


			<script type="text/javascript">

                // function init(){  
                //         google.maps.event.addListener(map, 'zoom_changed', function() {
                //             var bounds =  map.getBounds();
                //             var endLo = bounds.getNorthEast();
                //             var startLo = bounds.getSouthWest();
                //             addMarker(startLo, endLo);
                //         });

                //         google.maps.event.addListener(map, 'dragend', function(evt){
                //             var bounds =  map.getBounds();
                //             var endLo = bounds.getNorthEast();
                //             var startLo = bounds.getSouthWest();
                //             addMarker(startLo, endLo);
                //         });
                // }

                //                 //마커 출력 함수
                // function addMarker(startLo,endLo){
                //     for (var i=0; i < 반복횟수; i++){

                        
                //     marker = new google.maps.Marker({
                //                 position: latlng,
                //                 map: map,
                //                 icon: "truck.png",
                //                 title : carnm+'('+carid+')'
                //             });

                //              markersArray.push(marker);
                //             //지도에 출력된 마커를 클릭했을 경우 이벤트(infoWindow 출력)
                //              google.maps.event.addListener(marker, 'click', function (event){
                //             popInfoWindow(인포윈도우에 출력할 파라미터);    //popInfoWindow 함수는 생략
                //             });
                //     }
                // }




                var oSeoulCityPoint = new nhn.api.map.LatLng(37.5675451, 126.9773356);
                var defaultLevel = 11;
                var oMap = new nhn.api.map.Map(document.getElementById('map'), { 
                                                point : oSeoulCityPoint,
                                                zoom : defaultLevel,
                                                enableWheelZoom : true,
                                                enableDragPan : true,
                                                enableDblClickZoom : false,
                                                mapMode : 0,
                                                activateTrafficMap : false,
                                                activateBicycleMap : false,
                                                minMaxLevel : [ 1, 14 ]});
                var oSlider = new nhn.api.map.ZoomControl();
                oMap.addControl(oSlider);
                oSlider.setPosition({
                        top : 10,
                        left : 10
                });

                var oMapTypeBtn = new nhn.api.map.MapTypeBtn();
                oMap.addControl(oMapTypeBtn);
                oMapTypeBtn.setPosition({
                        bottom : 10,
                        right : 80
                });
                
                var oThemeMapBtn = new nhn.api.map.ThemeMapBtn();
                oThemeMapBtn.setPosition({
                        bottom : 10,
                        right : 10
                });
                oMap.addControl(oThemeMapBtn);


              
                var oSize = new nhn.api.map.Size(28, 37);
                var oOffset = new nhn.api.map.Size(14, 37);
                var oIcon = new nhn.api.map.Icon('http://static.naver.com/maps2/icons/pin_spot2.png', oSize, oOffset);

                var oInfoWnd = new nhn.api.map.InfoWindow();
                oInfoWnd.setVisible(false);
                oMap.addOverlay(oInfoWnd);

                oInfoWnd.setPosition({
                        top : 20,
                        left :20
                });


               	// 커스텀 ㅁ ㅏ커 하는법?
                 //아래는 위에서 지정한 좌표에 마커를 표시하는 소스 입니다.
                var oSize = new nhn.api.map.Size(28, 37);
                var oOffset = new nhn.api.map.Size(14, 37);
                var oIcon = new nhn.api.map.Icon('http://i1.daumcdn.net/localimg/localimages/07/mapapidoc/marker_red.png', oSize, oOffset);
                //icon 이미지를 바꿔서 사용할 수 있습니다.
                var oMarker = new nhn.api.map.Marker(oIcon, { title : '마커타이틀' }); 
                oMarker.setPoint(oSeoulCityPoint);
                oMap.addOverlay(oMarker);
                // 마커라벨 표시
                var oLabel1 = new nhn.api.map.MarkerLabel(); // 마커 라벨 선언
                oMap.addOverlay(oLabel1);// 마커 라벨 지도에 추가. 기본은 라벨이 보이지 않는 상태로 추가됨
                oLabel1.setVisible(true, oMarker);// 마커 라벨 보이기 



                var oLabel = new nhn.api.map.MarkerLabel(); // - 마커 라벨 선언.
                oMap.addOverlay(oLabel); // - 마커 라벨 지도에 추가. 기본은 라벨이 보이지 않는 상태로 추가됨.



                oInfoWnd.attach('changeVisible', function(oCustomEvent) {
                        if (oCustomEvent.visible) {
                                oLabel.setVisible(false);
                        }
                });
                
                var oPolyline = new nhn.api.map.Polyline([], {
                        strokeColor : '#f00', // - 선의 색깔
                        strokeWidth : 5, // - 선의 두께
                        strokeOpacity : 0.5 // - 선의 투명도
                }); // - polyline 선언, 첫번째 인자는 선이 그려질 점의 위치. 현재는 없음.
                oMap.addOverlay(oPolyline); // - 지도에 선을 추가함.

                oMap.attach('mouseenter', function(oCustomEvent) {

                        var oTarget = oCustomEvent.target;
                        // 마커위에 마우스 올라간거면
                        if (oTarget instanceof nhn.api.map.Marker) {
                                var oMarker = oTarget;
                                oLabel.setVisible(true, oMarker); // - 특정 마커를 지정하여 해당 마커의 title을 보여준다.
                        }
                });

                oMap.attach('mouseleave', function(oCustomEvent) {

                        var oTarget = oCustomEvent.target;
                        // 마커위에서 마우스 나간거면
                        if (oTarget instanceof nhn.api.map.Marker) {
                                oLabel.setVisible(false);
                        }
                });

                oMap.attach('click', function(oCustomEvent) {
                        var oPoint = oCustomEvent.point;
                        var oTarget = oCustomEvent.target;
                        oInfoWnd.setVisible(false);
                        // 마커 클릭하면
                        if (oTarget instanceof nhn.api.map.Marker) {
                                // 겹침 마커 클릭한거면
                                if (oCustomEvent.clickCoveredMarker) {
                                        return;
                                }
                                // - InfoWindow 에 들어갈 내용은 setContent 로 자유롭게 넣을 수 있습니다. 외부 css를 이용할 수 있으며, 
                                // - 외부 css에 선언된 class를 이용하면 해당 class의 스타일을 바로 적용할 수 있습니다.
                                // - 단, DIV 의 position style 은 absolute 가 되면 안되며, 
                                // - absolute 의 경우 autoPosition 이 동작하지 않습니다. 
                                oInfoWnd.setContent('<DIV style="border-top:1px solid; border-bottom:2px groove black; border-left:1px solid; border-right:2px groove black;margin-bottom:1px;color:black;background-color:white; width:auto; height:auto;">'+
                                        '<span style="color: #000000 !important;display: inline-block;font-size: 12px !important;font-weight: bold !important;letter-spacing: -1px !important;white-space: nowrap !important; padding: 2px 5px 2px 2px !important">' + 
                                        'Hello World <br /> ' + oTarget.getPoint()
                                        +'<span></div>');
                                oInfoWnd.setPoint(oTarget.getPoint());
                                oInfoWnd.setPosition({right : 15, top : 30});
                                oInfoWnd.setVisible(true);
                                oInfoWnd.autoPosition();
                                return;
                        }
                        var oMarker = new nhn.api.map.Marker(oIcon, { title : '마커 : ' + oPoint.toString() });
                        oMarker.setPoint(oPoint);
                        oMap.addOverlay(oMarker);

                        var aPoints = oPolyline.getPoints(); // - 현재 폴리라인을 이루는 점을 가져와서 배열에 저장.
                        aPoints.push(oPoint); // - 추가하고자 하는 점을 추가하여 배열로 저장함.
                        oPolyline.setPoints(aPoints); // - 해당 폴리라인에 배열에 저장된 점을 추가함
                });


        	</script>

           <form action="{{ url_for('map') }}" method='POST' enctype='multipart/form-data'>
                
                <input type='hidden' name='clinic_id' value="<?=$clinic_id?>"  > <br>


                <div>
                    남/녀 선택 :
                    <input type="checkbox" name="sex" value="man" >남자
                    <input type="checkbox" name="sex" value="woman">여자
                </div>

                <div>
                    연령대 선택 : <br>
                    10대: <input type="text" name="age[]" maxlength="3" size="3" value="0">명 이상 <br>
                    20대: <input type="text" name="age[]" maxlength="3" size="3" value="0">명 이상 <br>
                    30대: <input type="text" name="age[]" maxlength="3" size="3" value="0">명 이상 <br>
                    40대: <input type="text" name="age[]" maxlength="3" size="3" value="0">명 이상 <br>
                    50대: <input type="text" name="age[]" maxlength="3" size="3" value="0">명 이상 <br>

                </div>

                <div>
                    월 선택 : <br>
                    <input type="checkbox" name="month" value="1">1월
                    <input type="checkbox" name="month" value="2">2월
                    <input type="checkbox" name="month" value="3">3월
                    <input type="checkbox" name="month" value="4">4월
                    <input type="checkbox" name="month" value="5">5월
                    <input type="checkbox" name="month" value="6">6월
                    <input type="checkbox" name="month" value="7">7월
                    <input type="checkbox" name="month" value="8">8월
                    <input type="checkbox" name="month" value="9">9월
                    <input type="checkbox" name="month" value="10">10월
                    <input type="checkbox" name="month" value="11">11월
                    <input type="checkbox" name="month" value="12">12월

                </div>
    

              


                시간 선택 :
                <input type="checkbox" name="time" value="afternoon">점심: 12시~1시
                <input type="checkbox" name="time" value="evening">저녁: 7시~8시
            

            <input type='reset'> <input type='submit' value="검색"> <br>
            </form>

<script language="javascript">

    // 사용자가 택한 값을 디폴트로 다시 설정해주는 곳...

    {% if data %} 

        var sex = document.getElementsByName("sex");
        var age = document.getElementsByName("age[]");
        var month = document.getElementsByName("month");
        var time = document.getElementsByName("time");
            
        // 성별체크 
        {% if data.sex %}
            {% for temp in data.sex %}
                {% if temp =="man" %} sex[0].checked= true; 
                {% elif temp =="woman" %} sex[1].checked= true;
                {% endif %}
            {% endfor %}
        {% endif %}

        // 나이 체크 
        {% if data.age %}
            var i=0;
            {% for temp in data.age %}
                //age[0].disabled= temp;  
                // 일단 보류.. 
            {% endfor %}
        {% endif %}

        // 월 체크 
        {% if data.month %}
            {% for temp in data.month %}
                month[{{temp}}-1].checked= true; 
            {% endfor %}
        {% endif %}

          // 시간  체크 
        {% if data.time %}
            {% for temp in data.time %}
                {% if temp =="afternoon" %} time[0].checked= true; 
                {% elif temp =="evening" %} time[1].checked= true;
                {% endif %}
            {% endfor %}
        {% endif %}


    {% endif %}


</script>



        
{% endblock %}